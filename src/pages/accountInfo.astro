---
Astro.props.pageTitle = "Account Info";
import Layout from "../layouts/Layout.astro";
import "../styles/global.css";
import { readUserInfoRequest } from "./api/user.js";

let user = null;
let error = null;
let locals = {
    runtime: {
        env: {
            DB: import.meta.env.DB_KEY
        }
    }
}; // Define locals

try {
    const res = await readUserInfoRequest({
        worker: 'https://astro-d1-integration.ecrawford4.workers.dev/api/user',
        uid: 1,
        auth: locals.runtime.env.DB
    });
    if (res.ok) {
        user = await res.json();
    } else {
        error = await res.json();
    }
} catch (err) {
    error = { message: "Failed to fetch user data" };
}
---

<Layout>
    <h1>Account Info</h1>
    {user ? (
        <div>
            <p><strong>Name:</strong> {user[0]?.fname} {user[0]?.lname}</p>
            <p><strong>Email:</strong> {user[0]?.email}</p>
            <p><strong>Date of Birth:</strong> {user[0]?.dob}</p>
            <p><strong>Date of Joining:</strong> {user[0]?.doj}</p>
        </div>
    ) : (
        <p>{error?.message || "User not found"}</p>
    )}
</Layout>